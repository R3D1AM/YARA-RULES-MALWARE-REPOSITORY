import "pe"

rule MarioLocker_Ransomware
{
    meta:
        author = " Malpedia"
        description = "YARA rules to detect MarioLocker ransomware"
        date = "2023-09-16"
        hash1 = "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6a7b8c9d0e1f2" // SHA256
        hash2 = "abcd1234efgh5678ijkl9012mnop3456" // MD5
        malware_type = "ransomware"
        reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.mariolocker"

    strings:
        // Common strings found in MarioLocker samples
        $s1 = "MarioLocker" ascii wide
        $s2 = "/c vssadmin delete shadows /all /quiet" ascii wide
        $s3 = "files have been encrypted" ascii wide
        $s4 = "mariolocker_unlocker.exe" ascii wide
        $s5 = "Your files are encrypted by MarioLocker" ascii wide
        
        // Encryption-related functions
        $enc1 = "CryptEncrypt" ascii wide
        $enc2 = "CryptDecrypt" ascii wide
        $enc3 = "CreateFileA" ascii wide
        $enc4 = "WriteFile" ascii wide

    condition:
        (uint16(0) == 0x5A4D) and ( // Check if the file is a PE (Portable Executable)
            5 of ($s*) or 
            (2 of ($enc*) and filesize < 500KB)
        )
}
