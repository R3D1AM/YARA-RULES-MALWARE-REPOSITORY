import "pe"


rule Combined_Threat_Detection
{
    meta:
        description = "Detects threats based on IP address, CVEs, and file hashes"
        author = "Your Name"
        date = "2024-09-16"
        reference = "Threat indicators: IPv4, CVEs, File Hashes"

    strings:
        // IP Address associated with exploit
        $ip = "77.247.126.158"
        
        // CVE-related strings
        $cve_1 = "CVE-2020-3259"
        $cve_2 = "CVE-2023-20269"
        $cve_3 = "CVE-2023-27532"
        
    hashes:
        // MD5 hashes
        $md5_1 = "0a6757bea01c2c48b50b7ec2bc39e31c"
        $md5_2 = "6615ea2fa3b879d27687a7ce917e93b0"
        $md5_3 = "77a243cb73f6bdd610eeb10786b752fb"
        $md5_4 = "aee6801792d67607f228be8cec8291f9"
        $md5_5 = "b87639f9a6cf5ba8c9e1f297c5745a67"
        
        // SHA1 hash
        $sha1_1 = "8d4f19b221751297b0c3a10f105772d7286c9411"
    
    condition:
        // Match any condition: IP address, CVEs, or file hashes
        (
            $ip or                         // IP detection
            any of ($cve_*) or              // CVE detection
            hash.md5(0, filesize) == $md5_1 or
            hash.md5(0, filesize) == $md5_2 or
            hash.md5(0, filesize) == $md5_3 or
            hash.md5(0, filesize) == $md5_4 or
            hash.md5(0, filesize) == $md5_5 or
            hash.sha1(0, filesize) == $sha1_1  // File hash detection
        )
}
